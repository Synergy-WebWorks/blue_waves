import{r as s,u as O,s as Z,j as e,g as E,A as L}from"./app-DWKB3ECa.js";import{a as Y}from"./booking-info-thunk-Cf3Uhdtx.js";import"./booking-info-service-DTT3QBHq.js";const J=()=>{const[P,S]=s.useState(!1),c=new URLSearchParams(window.location.search).get("reference_id"),{booking_info:n}=O(a=>a.booking_info),[h,v]=s.useState("card"),[x,H]=s.useState(""),[w,j]=s.useState(""),[p,i]=s.useState(""),[f,N]=s.useState({error_code:"",message:"",errors:[{message:"",path:""}]});s.useEffect(()=>{Z.dispatch(Y(c))},[]);const[A,_]=s.useState(""),[k,u]=s.useState(!1),[g,M]=s.useState(!1),[l,R]=s.useState({card_number:"",card_exp_month:"",card_exp_year:"",card_cvn:""}),[I,W]=s.useState("PHP"),[o,y]=s.useState("");s.useEffect(()=>{y(n.initial)},[n.initial]);const b=(a,t)=>{const r=a.target.id,m=a.target.value;switch(t){case"cardDetails":R(d=>({...d,[r]:m}));break}},D=a=>a.replace(/(\d{4})(?=\d)/g,"$1 ");console.log("booking_info",n);const C=async a=>{a.preventDefault(),i(""),u(!0);const t=Xendit.card.validateCardNumber(l.card_number),r=Xendit.card.validateExpiry(l.card_exp_month,l.card_exp_year),m=Xendit.card.validateCvn(l.card_cvn);if(t===!1||r===!1||m===!1){u(!1),j("Invalid card details. Please check your card details and try again.");return}j(""),await Xendit.card.createToken({amount:o,card_holder_first_name:"marlou",card_holder_last_name:"pepito",card_holder_phone_number:"+639208868123",card_number:l.card_number,card_exp_month:l.card_exp_month,card_exp_year:l.card_exp_year,card_cvn:l.card_cvn,is_multiple_use:g,should_authenticate:!0},T)},T=(a,t)=>{if(a){console.log("Tokenization Error: ",a),u(!1),i(a.message),N(a);return}console.log("Card token:"+t.id);const r=t.id;Xendit.card.createAuthentication({amount:o,token_id:r},X)},X=(a,t)=>{switch(t.status){case"VERIFIED":console.log("Verified!!!",t),console.log(t.credit_card_token_id),E.post("/api/pay-with-card",{token_id:t.credit_card_token_id,authentication_id:t.id,currency:I,amount:o,billing_details:{given_names:`${n.fname}`,surname:`${n.lname}`,email:n.email,mobile_number:n.mobile,phone_number:n.mobile,address:{street_line1:n.address,street_line2:"sipaway island",city:"San Carlos City",province_state:"Negros Occidental",postal_code:"6127",country:"PH"}}}).then(r=>{u(!1),console.log("Response:",r),r.data.status==="CAPTURED"&&(console.log("Success: ",r.data),L.visit(`/card-payment/success?reference_id=${btoa(c)}`)),r.data.status==="FAILED"&&console.log("Failed: ",r.data),_("")}).catch(r=>{console.log("Error: ",r)});break;case"IN_REVIEW":console.log("In Review!!!",t),_(t.payer_authentication_url);break;case"FAILED":console.log("Failed!!!",t),_(""),u(!1),t.failure_reason==="AUTHENTICATION_FAILED"?i("Authentication Failed. Please make sure you entered your OTP code correctly and try again."):i("We encountered an error that prevents the payment to be fulfilled. Please check your card details and make sure you entered the OTP correctly.");break}},F=async a=>{a.preventDefault(),await E.post("/api/pay-via-ewallet",{amount:parseInt(o),currency:"PHP",checkout_method:"ONE_TIME_PAYMENT",channel_code:"PH_PAYMAYA",account_number:n.mobile,channel_properties:{success_redirect_url:`https://blue-waves.site/ewallet/success?reference_id=${btoa(c)}`,failure_redirect_url:`https://blue-waves.site/ewallet/failed?reference_id=${btoa(c)}`,cancel_redirect_url:`https://blue-waves.site/ewallet/cancel?reference_id=${btoa(c)}`}}).then(t=>{console.log("Success response:aaaaaaaaaaa ",t.data),window.location.href=t.data.actions.desktop_web_checkout_url}).catch(t=>{const r=JSON.parse(t.response.data.message);console.log("Error response: ",r.message),console.log("Errors: ",r.errors),i(r.message),N(r)})},$=(a,t)=>new Promise((r,m)=>{if(document.getElementById(t)){r();return}const d=document.createElement("script");d.src=a,d.id=t,d.onload=()=>r(),d.onerror=()=>m(new Error(`Failed to load ${a}`)),document.body.appendChild(d)});return s.useEffect(()=>{$("https://js.xendit.co/v1/xendit.min.js","xendit-script").then(()=>{S(!0),Xendit.setPublishableKey("xnd_public_development_Z_y4qoYh1FbRiXW40tkKdf7Gc9aA8pzvU6mgxN7OMe_XCcC2MXBMeVkTi_R0RJYc")}).catch(a=>console.error("Failed to load Xendit script:",a))},[P]),e.jsxs(e.Fragment,{children:[k?e.jsx("div",{className:"fixed left-0 top-0 z-10 flex h-full w-full items-center justify-center bg-black bg-opacity-75 backdrop-blur-md",children:e.jsxs("div",{className:"flex h-3/4 max-w-2xl flex-col items-center justify-center overflow-hidden rounded-xl bg-white p-8 shadow-2xl",children:[e.jsx("span",{className:"w-3/4 text-center text-xl font-bold",children:"Please confirm your identity by entering the one-time password (OTP) provided to you."}),e.jsx("iframe",{src:A,className:"h-full w-full"})]})}):null,e.jsxs("div",{className:"container mx-auto flex flex-col items-center justify-center gap-4",children:[e.jsxs("header",{className:"mt-8 text-sm",children:[e.jsx("h1",{className:"mb-2 text-xl font-bold",children:"Xendivel Checkout Example"}),e.jsxs("p",{className:"flex gap-3",children:[e.jsx("a",{href:"https://docs.xendit.co/credit-cards/integrations/test-scenarios",className:"border-b border-blue-600 text-blue-600",target:"_tab",children:"Test card numbers"}),e.jsx("a",{href:"https://docs.xendit.co/credit-cards/integrations/test-scenarios#simulating-failed-charge-transactions",className:"border-b border-blue-600 text-blue-600",target:"_tab",children:"Test failed scenarios"})]})]}),e.jsxs("div",{className:"mt-8 flex w-[500px] flex-col rounded-md border border-gray-300",children:[e.jsxs("div",{className:"flex w-full text-sm",children:[e.jsx("span",{className:`flex-1 cursor-pointer p-4 text-center ${h==="card"?"bg-white font-bold text-black":"bg-gray-200 hover:bg-gray-100"} rounded-tl-md`,onClick:()=>v("card"),children:"Credit/Debit Card"}),e.jsx("span",{className:`flex-1 cursor-pointer p-4 text-center ${h==="ewallet"?"bg-white font-bold text-black":"bg-gray-200 hover:bg-gray-100"} rounded-tr-md`,onClick:()=>v("ewallet"),children:"E-Wallet"})]}),e.jsxs("div",{className:`flex flex-col rounded-bl-md rounded-br-md bg-white p-8 shadow-md ${h==="card"?"flex":"hidden"} font-medium`,children:[e.jsx("input",{placeholder:"Amount to pay",type:"text",className:"mb-2 rounded-md border border-gray-300",value:o,onChange:a=>y(a.target.value)}),e.jsxs("form",{onSubmit:C,className:"mb-4 flex flex-col overflow-hidden rounded-md border border-gray-300 bg-gray-100 shadow-sm",children:[e.jsx("div",{className:"flex border-b border-gray-300",children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"relative flex",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"absolute right-0 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 transform text-gray-500",children:[e.jsx("path",{d:"M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z"}),e.jsx("path",{fillRule:"evenodd",d:"M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 3.75a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z",clipRule:"evenodd"})]}),e.jsx("input",{type:"text",id:"card_number",name:"card-number",className:"w-full border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"Card number",value:D(l.card_number),onChange:a=>b(a,"cardDetails")})]})})})}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex w-1/2",children:[e.jsx("input",{type:"text",id:"card_exp_month",name:"card-exp-month",className:"w-14 border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"MM",maxLength:2,value:l.card_exp_month,onChange:a=>b(a,"cardDetails")}),e.jsx("span",{className:"self-center px-3 font-bold text-gray-500",children:"/"}),e.jsx("input",{type:"text",id:"card_exp_year",name:"card-exp-year",className:"w-auto border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"YYYY",maxLength:4,value:l.card_exp_year,onChange:a=>b(a,"cardDetails")})]}),e.jsxs("div",{className:"relative flex w-1/2 border-l border-gray-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"absolute right-0 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 transform text-gray-500",children:e.jsx("path",{fillRule:"evenodd",d:"M12 1.5a5.25 5.25 0 0 0-5.25 5.25v3a3 3 0 0 0-3 3v6.75a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3v-6.75a3 3 0 0 0-3-3v-3c0-2.9-2.35-5.25-5.25-5.25Zm3.75 8.25v-3a3.75 3.75 0 1 0-7.5 0v3h7.5Z",clipRule:"evenodd"})}),e.jsx("input",{type:"text",id:"card_cvn",name:"card-cvn",className:"w-full border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"CVV",maxLength:4,value:l.card_cvn,onChange:a=>b(a,"cardDetails")})]})]})})]}),e.jsx("div",{className:`col-span-6 mb-4 justify-center gap-x-4 rounded-md bg-red-200 p-3 font-medium text-red-800 ${w!==""?"flex":"hidden"}`,children:w}),e.jsxs("div",{className:"col-span-6 flex items-center gap-x-4 rounded-md border border-gray-300 p-4 text-sm font-medium",children:[e.jsx("label",{htmlFor:"save-card-checkbox",className:"order-2",children:"Save my information for faster checkout"}),e.jsx("input",{id:"save-card-checkbox",type:"checkbox",checked:!!g,onChange:()=>M(!g)})]}),e.jsx("div",{className:"mt-4 flex flex-col gap-4",children:e.jsx("button",{className:"w-full rounded-md bg-black py-3 text-sm font-bold uppercase text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-black",disabled:!!k,onClick:C,children:"Charge Card"})})]}),e.jsxs("div",{className:`grid w-full grid-cols-6 gap-4 rounded-bl-md rounded-br-md bg-white p-8 shadow-sm ${h==="ewallet"?"flex":"hidden"}`,children:[e.jsx("input",{placeholder:"Amount to pay",type:"text",className:"col-span-6 mb-2 rounded-md border border-gray-300",value:o,onChange:a=>y(a.target.value)}),e.jsx("button",{className:"col-span-6 rounded-md bg-black py-3 text-sm font-bold uppercase text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-green-600",onClick:F,children:"Charge with eWallet"})]})]}),x!==""||p!==""?e.jsxs("div",{className:"my-2 flex w-[500px] flex-col gap-4 whitespace-nowrap rounded-md border border-gray-300 bg-white p-8 shadow-md",children:[e.jsx("span",{className:"mb-2 text-lg font-bold",children:"Xendit API Response"}),x!==""?e.jsxs(e.Fragment,{children:[g?e.jsxs("span",{className:"mb-2 flex items-center gap-4 whitespace-pre-wrap text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"h-8 w-8 text-blue-600",children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"})}),e.jsxs("span",{className:"flex-1",children:["If you choose to save this card for future transactions, make sure to store the"," ",e.jsx("code",{className:"rounded bg-gray-200 px-2 py-1 text-xs",children:"credit_card_token_id"})," ","in your database. This token is necessary for future charges without re-entering card details."]})]}):"",e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:x})]}):"",p!==""?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:p}):"",f&&f.errors?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:f.errors.map((a,t)=>e.jsxs("span",{className:"flex w-full justify-between",children:[e.jsx("span",{children:a.path}),e.jsx("span",{children:a.message})]},t))}):"",x===""&&p===""?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-center text-xs leading-relaxed",children:"There's no response yet from Xendit."}):""]}):null]})]})};export{J as default};
