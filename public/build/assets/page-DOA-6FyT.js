import{r,u as U,s as W,j as e,g as M,A as H}from"./app-LpQuIY55.js";import{a as G}from"./booking-info-thunk-DEwBFlru.js";import"./booking-info-service-DeioyVAy.js";const Q=()=>{const[I,$]=r.useState(!1),d=new URLSearchParams(window.location.search).get("reference_id"),{booking_info:n}=U(a=>a.booking_info),[j,b]=r.useState(!1),[x,N]=r.useState("card"),[h,B]=r.useState(""),[k,C]=r.useState(""),[p,i]=r.useState(""),[_,E]=r.useState("PH_GCASH"),[y,P]=r.useState({error_code:"",message:"",errors:[{message:"",path:""}]});r.useEffect(()=>{W.dispatch(G(d))},[]);const[D,w]=r.useState(""),[A,u]=r.useState(!1),[g,R]=r.useState(!1),[l,T]=r.useState({card_number:"",card_exp_month:"",card_exp_year:"",card_cvn:""}),[F,z]=r.useState("PHP"),[o,v]=r.useState("");r.useEffect(()=>{v(n.initial)},[n.initial]);const f=(a,t)=>{const s=a.target.id,m=a.target.value;switch(t){case"cardDetails":T(c=>({...c,[s]:m}));break}},X=a=>a.replace(/(\d{4})(?=\d)/g,"$1 ");console.log("booking_info",n);const S=async a=>{a.preventDefault(),i(""),u(!0);const t=Xendit.card.validateCardNumber(l.card_number),s=Xendit.card.validateExpiry(l.card_exp_month,l.card_exp_year),m=Xendit.card.validateCvn(l.card_cvn);if(t===!1||s===!1||m===!1){u(!1),C("Invalid card details. Please check your card details and try again.");return}C(""),await Xendit.card.createToken({amount:o,card_holder_first_name:"marlou",card_holder_last_name:"pepito",card_holder_phone_number:"+639208868123",card_number:l.card_number,card_exp_month:l.card_exp_month,card_exp_year:l.card_exp_year,card_cvn:l.card_cvn,is_multiple_use:g,should_authenticate:!0},L)},L=(a,t)=>{if(a){console.log("Tokenization Error: ",a),u(!1),i(a.message),P(a);return}console.log("Card token:"+t.id);const s=t.id;Xendit.card.createAuthentication({amount:o,token_id:s},Y)},Y=(a,t)=>{switch(t.status){case"VERIFIED":console.log("Verified!!!",t),console.log(t.credit_card_token_id),M.post("/api/pay-with-card",{token_id:t.credit_card_token_id,authentication_id:t.id,currency:F,amount:o,reference_id:d,billing_details:{given_names:`${n.fname}`,surname:`${n.lname}`,email:n.email,mobile_number:n.mobile,phone_number:n.mobile,address:{street_line1:n.address,street_line2:"sipaway island",city:"San Carlos City",province_state:"Negros Occidental",postal_code:"6127",country:"PH"}}}).then(s=>{u(!1),s.data.status==="CAPTURED"&&(console.log("Success: ",s.data),H.visit(`/card-payment/success?reference_id=${btoa(d)}&status=success`)),s.data.status==="FAILED"&&(console.log("failed: ",s.data),H.visit(`/card-payment/failed?reference_id=${btoa(d)}&status=failed`)),w("")}).catch(s=>{console.log("Error: ",s)});break;case"IN_REVIEW":console.log("In Review!!!",t),w(t.payer_authentication_url);break;case"FAILED":console.log("Failed!!!",t),w(""),u(!1),t.failure_reason==="AUTHENTICATION_FAILED"?i("Authentication Failed. Please make sure you entered your OTP code correctly and try again."):i("We encountered an error that prevents the payment to be fulfilled. Please check your card details and make sure you entered the OTP correctly.");break}},Z=async a=>{a.preventDefault(),b(!0),await M.post("/api/pay-via-ewallet",{amount:parseInt(o),currency:"PHP",checkout_method:"ONE_TIME_PAYMENT",reference_id:d,channel_code:_,account_number:n.mobile,channel_properties:{success_redirect_url:`${window.location.origin}/ewallet/success?reference_id=${btoa(d)}&status=success`,failure_redirect_url:`${window.location.origin}/ewallet/failed?reference_id=${btoa(d)}&status=failed`,cancel_redirect_url:`${window.location.origin}/ewallet/cancel?reference_id=${btoa(d)}&status=cancelled`}}).then(t=>{console.log("Success response:aaaaaaaaaaa ",t.data),window.location.href=t.data.actions.desktop_web_checkout_url,b(!1)}).catch(t=>{const s=JSON.parse(t.response.data.message);console.log("Error response: ",s.message),console.log("Errors: ",s.errors),i(s.message),P(s),b(!1)})},O=(a,t)=>new Promise((s,m)=>{if(document.getElementById(t)){s();return}const c=document.createElement("script");c.src=a,c.id=t,c.onload=()=>s(),c.onerror=()=>m(new Error(`Failed to load ${a}`)),document.body.appendChild(c)});return r.useEffect(()=>{O("https://js.xendit.co/v1/xendit.min.js","xendit-script").then(()=>{$(!0),Xendit.setPublishableKey(void 0)}).catch(a=>console.error("Failed to load Xendit script:",a))},[I]),e.jsxs(e.Fragment,{children:[A?e.jsx("div",{className:"fixed left-0 top-0 z-10 flex h-full w-full items-center justify-center bg-black bg-opacity-75 backdrop-blur-md",children:e.jsxs("div",{className:"flex h-3/4 max-w-2xl flex-col items-center justify-center overflow-hidden rounded-xl bg-white p-8 shadow-2xl",children:[e.jsx("span",{className:"w-3/4 text-center text-xl font-bold",children:"Please wait until the transactions are successful."}),e.jsx("iframe",{src:D,className:"h-full w-full"})]})}):null,e.jsxs("div",{className:"container mx-auto flex flex-col items-center justify-center gap-4",children:[e.jsxs("header",{className:"mt-8 text-sm",children:[e.jsx("h1",{className:"mb-2 text-xl font-bold",children:"Xendivel Checkout Example"}),e.jsxs("p",{className:"flex gap-3",children:[e.jsx("a",{href:"https://docs.xendit.co/credit-cards/integrations/test-scenarios",className:"border-b border-blue-600 text-blue-600",target:"_tab",children:"Test card numbers"}),e.jsx("a",{href:"https://docs.xendit.co/credit-cards/integrations/test-scenarios#simulating-failed-charge-transactions",className:"border-b border-blue-600 text-blue-600",target:"_tab",children:"Test failed scenarios"})]})]}),e.jsxs("div",{className:"mt-8 flex lg:w-[500px] sm:w-[400px] mx-5 flex-col rounded-md border border-gray-300",children:[e.jsxs("div",{className:"flex w-full text-sm",children:[e.jsx("span",{className:`flex-1 cursor-pointer p-4 text-center ${x==="card"?"bg-white font-bold text-black":"bg-gray-200 hover:bg-gray-100"} rounded-tl-md`,onClick:()=>N("card"),children:"Credit/Debit Card"}),e.jsx("span",{className:`flex-1 cursor-pointer p-4 text-center ${x==="ewallet"?"bg-white font-bold text-black":"bg-gray-200 hover:bg-gray-100"} rounded-tr-md`,onClick:()=>N("ewallet"),children:"E-Wallet"})]}),e.jsxs("div",{className:`flex flex-col rounded-bl-md rounded-br-md bg-white p-8 shadow-md ${x==="card"?"flex":"hidden"} font-medium`,children:[e.jsx("input",{placeholder:"Amount to pay",type:"text",className:"mb-2 rounded-md border border-gray-300",value:o,disabled:!0,onChange:a=>v(a.target.value)}),e.jsxs("form",{onSubmit:S,className:"mb-4 flex flex-col overflow-hidden rounded-md border border-gray-300 bg-gray-100 shadow-sm",children:[e.jsx("div",{className:"flex border-b border-gray-300",children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"relative flex",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"absolute right-0 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 transform text-gray-500",children:[e.jsx("path",{d:"M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z"}),e.jsx("path",{fillRule:"evenodd",d:"M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 3.75a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z",clipRule:"evenodd"})]}),e.jsx("input",{type:"text",id:"card_number",name:"card-number",className:"w-full border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"Card number",value:X(l.card_number),onChange:a=>f(a,"cardDetails")})]})})})}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex w-1/2",children:[e.jsx("input",{type:"text",id:"card_exp_month",name:"card-exp-month",className:"w-14 border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"MM",maxLength:2,value:l.card_exp_month,onChange:a=>f(a,"cardDetails")}),e.jsx("span",{className:"self-center px-3 font-bold text-gray-500",children:"/"}),e.jsx("input",{type:"text",id:"card_exp_year",name:"card-exp-year",className:"w-auto border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"YYYY",maxLength:4,value:l.card_exp_year,onChange:a=>f(a,"cardDetails")})]}),e.jsxs("div",{className:"relative flex w-1/2 border-l border-gray-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"absolute right-0 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 transform text-gray-500",children:e.jsx("path",{fillRule:"evenodd",d:"M12 1.5a5.25 5.25 0 0 0-5.25 5.25v3a3 3 0 0 0-3 3v6.75a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3v-6.75a3 3 0 0 0-3-3v-3c0-2.9-2.35-5.25-5.25-5.25Zm3.75 8.25v-3a3.75 3.75 0 1 0-7.5 0v3h7.5Z",clipRule:"evenodd"})}),e.jsx("input",{type:"text",id:"card_cvn",name:"card-cvn",className:"w-full border-none bg-gray-100 p-3 outline-none ring-0 focus:bg-gray-200 focus:ring-0",placeholder:"CVV",maxLength:4,value:l.card_cvn,onChange:a=>f(a,"cardDetails")})]})]})})]}),e.jsx("div",{className:`col-span-6 mb-4 justify-center gap-x-4 rounded-md bg-red-200 p-3 font-medium text-red-800 ${k!==""?"flex":"hidden"}`,children:k}),e.jsxs("div",{className:"col-span-6 flex items-center gap-x-4 rounded-md border border-gray-300 p-4 text-sm font-medium",children:[e.jsx("label",{htmlFor:"save-card-checkbox",className:"order-2",children:"Save my information for faster checkout"}),e.jsx("input",{id:"save-card-checkbox",type:"checkbox",checked:!!g,onChange:()=>R(!g)})]}),e.jsx("div",{className:"mt-4 flex flex-col gap-4",children:e.jsx("button",{className:"w-full rounded-md bg-black py-3 text-sm font-bold uppercase text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-black",disabled:!!A,onClick:S,children:"Charge Card"})})]}),e.jsxs("div",{className:`grid w-full grid-cols-6 gap-4 rounded-bl-md rounded-br-md bg-white p-8 shadow-sm ${x==="ewallet"?"flex":"hidden"}`,children:[e.jsxs("div",{className:"p-4 w-96 flex flex-col",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Select E-Wallet"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"ewallet",value:"PH_GCASH",checked:_==="PH_GCASH",onChange:()=>E("PH_GCASH"),className:"form-radio text-blue-600"}),e.jsx("span",{children:"Gcash"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"ewallet",value:"PH_PAYMAYA",checked:_==="PH_PAYMAYA",onChange:()=>E("PH_PAYMAYA"),className:"form-radio text-green-600"}),e.jsx("span",{children:"PayMaya"})]})]})]}),e.jsx("input",{placeholder:"Amount to pay",type:"text",className:"col-span-6 mb-2 rounded-md border border-gray-300",value:o,disabled:!0,onChange:a=>v(a.target.value)}),e.jsx("button",{disabled:j,className:"col-span-6 rounded-md bg-black py-3 text-sm font-bold uppercase text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-green-600",onClick:Z,children:j?"Loading...":"Charge with eWallet"})]})]}),h!==""||p!==""?e.jsxs("div",{className:"my-2 flex w-[500px] flex-col gap-4 whitespace-nowrap rounded-md border border-gray-300 bg-white p-8 shadow-md",children:[e.jsx("span",{className:"mb-2 text-lg font-bold",children:"Xendit API Response"}),h!==""?e.jsxs(e.Fragment,{children:[g?e.jsxs("span",{className:"mb-2 flex items-center gap-4 whitespace-pre-wrap text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","data-slot":"icon",className:"h-8 w-8 text-blue-600",children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 0 1 .67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 1 1-.671-1.34l.041-.022ZM12 9a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z",clipRule:"evenodd"})}),e.jsxs("span",{className:"flex-1",children:["If you choose to save this card for future transactions, make sure to store the"," ",e.jsx("code",{className:"rounded bg-gray-200 px-2 py-1 text-xs",children:"credit_card_token_id"})," ","in your database. This token is necessary for future charges without re-entering card details."]})]}):"",e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:h})]}):"",p!==""?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:p}):"",y&&y.errors?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-xs leading-relaxed",children:y.errors.map((a,t)=>e.jsxs("span",{className:"flex w-full justify-between",children:[e.jsx("span",{children:a.path}),e.jsx("span",{children:a.message})]},t))}):"",h===""&&p===""?e.jsx("pre",{className:"whitespace-pre-wrap rounded-md bg-gray-100 p-4 text-center text-xs leading-relaxed",children:"There's no response yet from Xendit."}):""]}):null]})]})};export{Q as default};
